<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Due Date Field Diagnostic Test</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      max-width: 800px;
      margin: 0 auto;
    }
    .test-section {
      margin: 20px 0;
      padding: 15px;
      border: 2px solid #ccc;
      border-radius: 8px;
      background-color: #f9f9f9;
    }
    .success { border-color: #4CAF50; background-color: #e8f5e9; }
    .error { border-color: #f44336; background-color: #ffebee; }
    h1 { color: #333; }
    h2 { color: #666; font-size: 18px; margin-top: 0; }
    pre { background: #fff; padding: 10px; border-radius: 4px; overflow-x: auto; }
    .form-group { margin-bottom: 15px; }
    .form-group label {
      display: block;
      font-weight: 600;
      margin-bottom: 6px;
      color: #555;
      font-size: 12px;
      text-transform: uppercase;
    }
    .form-group input[type="date"] {
      width: 100%;
      padding: 8px 10px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 13px;
      font-family: inherit;
      min-height: 36px;
      display: block;
    }
    button {
      background: #1a1a1a;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
      margin: 5px;
    }
    button:hover { background: #333; }
    #results { margin-top: 20px; }
    .result-item { padding: 5px 0; }
    .result-ok { color: #4CAF50; font-weight: bold; }
    .result-fail { color: #f44336; font-weight: bold; }
  </style>
</head>
<body>
  <h1>üîç Due Date Field Diagnostic Test</h1>

  <div class="test-section">
    <h2>Test 1: Basic Date Input Support</h2>
    <div class="form-group">
      <label for="testDate1">Basic Date Input:</label>
      <input type="date" id="testDate1">
    </div>
    <p id="test1Result"></p>
  </div>

  <div class="test-section">
    <h2>Test 2: Date Input with Extension Styling</h2>
    <div class="form-group">
      <label for="testDate2">Styled Date Input (with extension CSS):</label>
      <input type="date" id="testDate2" required>
    </div>
    <p id="test2Result"></p>
  </div>

  <div class="test-section">
    <h2>Test 3: Set Today's Date Programmatically</h2>
    <div class="form-group">
      <label for="testDate3">Auto-filled Date:</label>
      <input type="date" id="testDate3" required>
    </div>
    <button onclick="setToday()">Set to Today</button>
    <p id="test3Result"></p>
  </div>

  <div class="test-section">
    <h2>Test 4: Browser Information</h2>
    <div id="browserInfo"></div>
  </div>

  <div class="test-section">
    <h2>Test 5: Extension Files Check</h2>
    <button onclick="checkExtensionFiles()">Check Extension Files</button>
    <div id="fileCheckResults"></div>
  </div>

  <div id="results">
    <h2>Diagnostic Results:</h2>
    <div id="diagnosticResults"></div>
  </div>

  <script>
    // Test 1: Basic support
    const test1 = document.getElementById('testDate1');
    const test1Result = document.getElementById('test1Result');
    if (test1.type === 'date') {
      test1Result.innerHTML = '<span class="result-ok">‚úÖ PASS: Your browser supports date inputs</span>';
      test1Result.parentElement.classList.add('success');
    } else {
      test1Result.innerHTML = '<span class="result-fail">‚ùå FAIL: Your browser does NOT support date inputs</span>';
      test1Result.parentElement.classList.add('error');
    }

    // Test 2: Styling
    const test2 = document.getElementById('testDate2');
    const test2Result = document.getElementById('test2Result');
    const computedStyle = window.getComputedStyle(test2);
    test2Result.innerHTML = `
      <span class="result-ok">‚úÖ Computed Styles:</span><br>
      Display: ${computedStyle.display}<br>
      Width: ${computedStyle.width}<br>
      Height: ${computedStyle.height}<br>
      Visibility: ${computedStyle.visibility}<br>
      Opacity: ${computedStyle.opacity}
    `;
    test2Result.parentElement.classList.add('success');

    // Test 3: Set today
    function setToday() {
      const today = new Date().toISOString().split('T')[0];
      const test3 = document.getElementById('testDate3');
      test3.value = today;
      const test3Result = document.getElementById('test3Result');
      test3Result.innerHTML = `<span class="result-ok">‚úÖ Date set to: ${test3.value}</span>`;
      test3Result.parentElement.classList.add('success');
    }
    // Auto-run test 3
    setToday();

    // Test 4: Browser info
    const browserInfo = document.getElementById('browserInfo');
    browserInfo.innerHTML = `
      <strong>User Agent:</strong> ${navigator.userAgent}<br>
      <strong>Platform:</strong> ${navigator.platform}<br>
      <strong>Language:</strong> ${navigator.language}<br>
      <strong>Cookies Enabled:</strong> ${navigator.cookieEnabled}
    `;

    // Test 5: Check extension files
    async function checkExtensionFiles() {
      const results = document.getElementById('fileCheckResults');
      results.innerHTML = '<p>Checking files...</p>';

      try {
        // Try to fetch the HTML file
        const htmlResponse = await fetch('popup/popup.html');
        const htmlText = await htmlResponse.text();

        // Check if dueDate field exists
        const hasDueDateField = htmlText.includes('id="dueDate"');
        const hasReviewDueDateField = htmlText.includes('id="reviewDueDateInput"');

        // Try to fetch the CSS file
        const cssResponse = await fetch('popup/popup.css');
        const cssText = await cssResponse.text();

        // Check if date input styling exists
        const hasDateInputCSS = cssText.includes('input[type="date"]');

        results.innerHTML = `
          <div class="result-item">
            ${hasDueDateField ? '<span class="result-ok">‚úÖ' : '<span class="result-fail">‚ùå'} Main form dueDate field: ${hasDueDateField ? 'FOUND' : 'NOT FOUND'}</span>
          </div>
          <div class="result-item">
            ${hasReviewDueDateField ? '<span class="result-ok">‚úÖ' : '<span class="result-fail">‚ùå'} Review modal dueDate field: ${hasReviewDueDateField ? 'FOUND' : 'NOT FOUND'}</span>
          </div>
          <div class="result-item">
            ${hasDateInputCSS ? '<span class="result-ok">‚úÖ' : '<span class="result-fail">‚ùå'} CSS styling for date inputs: ${hasDateInputCSS ? 'FOUND' : 'NOT FOUND'}</span>
          </div>
          <details style="margin-top: 10px;">
            <summary style="cursor: pointer;">View HTML snippet</summary>
            <pre>${htmlText.substring(htmlText.indexOf('id="dueDate"') - 100, htmlText.indexOf('id="dueDate"') + 100)}</pre>
          </details>
        `;
      } catch (error) {
        results.innerHTML = `<span class="result-fail">‚ùå Error checking files: ${error.message}</span>`;
      }
    }

    // Run diagnostics on load
    window.addEventListener('load', () => {
      const diagnosticResults = document.getElementById('diagnosticResults');
      const allTests = [
        test1.type === 'date',
        computedStyle.display !== 'none',
        document.getElementById('testDate3').value !== ''
      ];

      const passed = allTests.filter(t => t).length;
      const total = allTests.length;

      diagnosticResults.innerHTML = `
        <h3>Summary: ${passed}/${total} tests passed</h3>
        ${passed === total
          ? '<p class="result-ok">‚úÖ All basic tests passed! The date input should work.</p>'
          : '<p class="result-fail">‚ùå Some tests failed. There may be browser compatibility issues.</p>'}
      `;
    });
  </script>
</body>
</html>
